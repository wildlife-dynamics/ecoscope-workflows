{% macro handle_task(t, params) %}
{% if t.mode == "call" %}
    {{ t.id }} = {{ t.known_task.importable_reference.function }}.replace(validate=True)(
    {%- if t.arg_dependencies %}
        {% for arg in t.arg_dependencies %}
            {{ arg }}={{ t.arg_dependencies[arg] }},
        {% endfor %}
        **params["{{ t.id }}"],
    )
    {% else %}
        **params["{{ t.id }}"],
    )
    {% endif %}
{% elif t.mode == "map" %}
    {{ t.id }}_partial = partial({{ t.known_task.importable_reference.function }}.replace(validate=True), **params["{{ t.id }}"])
    {{ t.id }}_mapped_iterable = map({{ t.id }}_partial, {{ t.map_iterable }})
    {{ t.id }} = list({{ t.id }}_mapped_iterable)
{% endif %}
{% endmacro %}
